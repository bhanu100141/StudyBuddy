generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  STUDENT
  TEACHER
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      UserRole @default(STUDENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  chats     Chat[]
  materials Material[]
  courses   Course[]
  schedules Schedule[]
}

model Material {
  id        String   @id @default(uuid())
  userId    String
  fileName  String
  fileUrl   String
  fileType  String
  fileSize  Int
  content   String?  @db.Text
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Chat {
  id        String   @id @default(uuid())
  userId    String
  title     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  Message[]

  @@index([userId])
}

model Message {
  id           String   @id @default(uuid())
  chatId       String
  role         String   // "user" or "assistant"
  content      String   @db.Text
  createdAt    DateTime @default(now())

  // File attachment fields
  hasAttachment Boolean  @default(false)
  fileName      String?
  fileUrl       String?
  fileType      String?
  fileSize      Int?
  fileContent   String?  @db.Text // Extracted text content from file

  chat          Chat     @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([chatId])
}

enum ScheduleType {
  CLASS
  ASSIGNMENT
  EXAM
  TASK
  OTHER
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

model Course {
  id          String   @id @default(uuid())
  userId      String
  name        String
  code        String?
  instructor  String?
  color       String   @default("#3B82F6") // Hex color for UI
  credits     Int?
  semester    String?
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  schedules   Schedule[]

  @@index([userId])
}

model Schedule {
  id          String       @id @default(uuid())
  userId      String
  courseId    String?
  title       String
  description String?      @db.Text
  type        ScheduleType @default(OTHER)
  date        DateTime
  startTime   String?      // Format: "HH:MM"
  endTime     String?      // Format: "HH:MM"
  location    String?
  isCompleted Boolean      @default(false)
  priority    Priority     @default(MEDIUM)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  course      Course?      @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([courseId])
  @@index([date])
}
